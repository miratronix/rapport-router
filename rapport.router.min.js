!function e(t,r,n){function o(i,u){if(!r[i]){if(!t[i]){var s="function"==typeof require&&require;if(!u&&s)return s(i,!0);if(a)return a(i,!0);var c=new Error("Cannot find module '"+i+"'");throw c.code="MODULE_NOT_FOUND",c}var f=r[i]={exports:{}};t[i][0].call(f.exports,function(e){var r=t[i][1][e];return o(r?r:e)},f,f.exports,e,t,r,n)}return r[i].exports}for(var a="function"==typeof require&&require,i=0;i<n.length;i++)o(n[i]);return o}({1:[function(e,t,r){"use strict";var n=e("./router.js"),o=e("./websocket.js"),a=e("./util.js"),i={extendWebsocket:function(e,t,r,n){if(n&&n.router&&!a.isObject(n.router)&&!a.isFunction(n.router.handle))throw new TypeError("options.router must be a Rapport router");o(e,t,r,n)},extendRapportConstructor:function(e){e.Router=n},extendRapportInstance:function(e){e.Router=n}};"undefined"!=typeof window&&(window.RapportRouter=i),"undefined"!=typeof t&&(t.exports=i)},{"./router.js":3,"./util.js":4,"./websocket.js":5}],2:[function(e,t,r){"use strict";function n(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}var o=e("./util.js"),a={create:function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];var a=[];if(!r||0===r.length)throw new TypeError("At least one handler function must be supplied");for(var i=0;i<r.length;i++){var u={method:e};if(!o.isFunction(r[i]))throw new TypeError("Handlers must be functions");u.handle=r[i],a.push(u)}return a},handledMethods:function e(t){for(var e={},r=0;r<t.length;r++)e[t[r].method]=!0;return e},traverse:function(e,t,r,n,a){var i=function i(){if(r.length>0){var u=r.shift();if("all"===u.method||u.method===e.method)try{var s=void 0;s=a?u.handle(a,e,t,i):u.handle(e,t,i),s&&o.isFunction(s.then)&&s.then(i,n)}catch(e){n(e)}else i()}};i()},append:function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),o=1;o<t;o++)r[o-1]=arguments[o];for(var a=0;a<r.length;a++)r[a]&&0!==r[a].length&&e.push.apply(e,n(r[a]));return e}};t.exports=a},{"./util.js":4}],3:[function(e,t,r){"use strict";var n=e("path-to-regexp"),o=e("./route.chain.js"),a=e("./util.js"),i=function(e){var t=[];return n(e,t),0!==t.length},u=function(){var e={},t=[],r=[],u=[],s=function u(s,c){if(a.isArray(s))for(var f=0;f<s.length;f++)u(s[f],c);else{if(!a.isString(s))throw new TypeError("Routes must be strings");var l=a.trimSlashes(s);if(i(l)){for(var p=0;p<t.length;p++)if(t[p].route===l)return o.append(t[p].chain,c),void(t[p].handledMethods=o.handledMethods(t[p].chain));var h=[],d=n(l,h),g=o.append([],r,c),v=o.handledMethods(g);t.push({keys:h,regex:d,handledMethods:v,route:l,chain:g})}else e[l]||(e[l]={chain:o.append([],r)}),o.append(e[l].chain,c),e[l].handledMethods=o.handledMethods(e[l].chain)}},c=function(e){o.append(u,e)},f=function(n){o.append(r,n),a.forEach(e,function(e,t){o.append(t.chain,n),t.handledMethods=o.handledMethods(t.chain)});for(var i=0;i<t.length;i++)o.append(t[i].chain,n),t[i].handledMethods=o.handledMethods(t[i].chain)},l=function e(t,r){if(a.isArray(t))for(var n=0;n<t.length;n++)e(t[n],r);else if(a.isArray(r))for(var o=0;o<r.length;o++)e(t,r[o]);else{if(!a.isString(t))throw new TypeError("Routes must be strings");if(!(a.isObject(r)&&a.isFunction(r.getRoutes)&&a.isFunction(r.getRegexRoutes)&&a.isFunction(r.getErrorHandlers)))throw new TypeError("Router must be a Rapport router");a.forEach(r.getRoutes(),function(e,r){s(a.combineUrls(t,e),r.chain)});for(var i=r.getRegexRoutes(),u=0;u<i.length;u++)s(a.combineUrls(t,i[u].route),i[u].chain);c(r.getErrorHandlers())}},p={getRoutes:function(){return e},getRegexRoutes:function(){return t},getErrorHandlers:function(){return u},use:function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];if(a.isString(e)||a.isArray(e)){if(!r||0===r.length)throw new TypeError("At least one Rapport router must be supplied");l(e,r)}else if(a.isObject(e))l("",[e].concat(r));else{if(!a.isFunction(e))throw new TypeError("First parameter must be a string, Rapport router, or function");f(o.create.apply(o,["all"].concat([e].concat(r))))}},all:function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];s(e,o.create.apply(o,["all"].concat(r)))},put:function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];s(e,o.create.apply(o,["put"].concat(r)))},post:function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];s(e,o.create.apply(o,["post"].concat(r)))},patch:function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];s(e,o.create.apply(o,["patch"].concat(r)))},get:function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];s(e,o.create.apply(o,["get"].concat(r)))},delete:function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];s(e,o.create.apply(o,["delete"].concat(r)))},error:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];c(o.create.apply(o,["all"].concat(t)))},handle:function(e,t){var r=a.trimSlashes(e.url),n=function(r){var n=o.append([],p.getErrorHandlers()),i=function(e){var r=500;a.isObject(e)&&e.status&&(r=e.status,delete e.status),t.status(r).send(e)};return 0===n.length?void i(r):void o.traverse(e,t,n,i,r)},i=function(){for(var a=p.getRegexRoutes(),i=[],u=0;u<a.length;u++){var s=a[u],c=r.match(s.regex);if(null!==c&&(c.shift(),s.handledMethods.all||s.handledMethods[e.method])){e.params={};for(var f=0;f<s.keys.length;f++)e.params[s.keys[f].name]=c[f];o.append(i,s.chain);break}}if(0===i.length){var l=new Error("Not Found");return l.status=404,void n(l)}o.traverse(e,t,i,n)},u=function(){var a=p.getRoutes()[r],u=a?o.append([],a.chain):[];return 0===u.length||!a.handledMethods.all&&!a.handledMethods[e.method]?void i():void o.traverse(e,t,u,n)};u()}};return p};t.exports=u},{"./route.chain.js":2,"./util.js":4,"path-to-regexp":7}],4:[function(e,t,r){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o={trimSlashes:function(e){var t=e;return o.endsWith(t,"/")&&(t=t.substring(0,t.length-1)),o.startsWith(t,"/")&&(t=t.substring(1,t.length)),t},combineUrls:function(e,t){var r=o.trimSlashes(e),n=o.trimSlashes(t);return 0!==r.length&&0!==n.length?r+"/"+n:0===r.length?n:r},endsWith:function(e,t){return e.indexOf(t,e.length-t.length)!==-1},startsWith:function(e,t){return 0===e.lastIndexOf(t,0)},isFunction:function(e){return"function"==typeof e},isString:function(e){return"string"==typeof e},isArray:function(e){return Array.isArray(e)},isObject:function(e){return"object"===("undefined"==typeof e?"undefined":n(e))},forEach:function(e,t){for(var r in e)e.hasOwnProperty(r)&&t(r,e[r])}};t.exports=o},{}],5:[function(e,t,r){"use strict";var n=function(e,t,r,n){var o=n.url.indexOf("?")>=0,a=o?n.url.substr(0,n.url.indexOf("?")):n.url,i=o?n.url.substr(n.url.indexOf("?")+1).split("&"):[],u={};if(i&&i.length>0)for(var s=0;s<i.length;s++){var c=decodeURIComponent(i[s].substr(0,i[s].indexOf("=")));u[c]=decodeURIComponent(i[s].substr(i[s].indexOf("=")+1))}var f={id:r,method:n.method,body:n.body,url:a,query:u},l={_status:200,sent:!1,status:function(e){return l._status=e,l},respond:function(t){l.sent=!0,e.respond(r,t)},respondWithError:function(t){l.sent=!0,e.respondWithError(r,t)},send:function(e){var t={status:l._status,body:e};l._status>=200&&l._status<300?l.respond(t):l.respondWithError(t)}};t.handle(f,l)};t.exports=function(e){var t=e._functions.onMessage.handleRequest;e._functions.onMessage.handleRequest=function(e,r,o,a,i,u,s){a&&a.router&&u.method&&u.url?n(r,a.router,i,u):t(e,r,o,a,i,u,s)}}},{}],6:[function(e,t,r){t.exports=Array.isArray||function(e){return"[object Array]"==Object.prototype.toString.call(e)}},{}],7:[function(e,t,r){function n(e,t){for(var r,n=[],o=0,a=0,i="",u=t&&t.delimiter||"/";null!=(r=m.exec(e));){var f=r[0],l=r[1],p=r.index;if(i+=e.slice(a,p),a=p+f.length,l)i+=l[1];else{var h=e[a],d=r[2],g=r[3],v=r[4],y=r[5],x=r[6],b=r[7];i&&(n.push(i),i="");var w=null!=d&&null!=h&&h!==d,R="+"===x||"*"===x,E="?"===x||"*"===x,A=r[2]||u,j=v||y;n.push({name:g||o++,prefix:d||"",delimiter:A,optional:E,repeat:R,partial:w,asterisk:!!b,pattern:j?c(j):b?".*":"[^"+s(A)+"]+?"})}}return a<e.length&&(i+=e.substr(a)),i&&n.push(i),n}function o(e,t){return u(n(e,t))}function a(e){return encodeURI(e).replace(/[\/?#]/g,function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()})}function i(e){return encodeURI(e).replace(/[?#]/g,function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()})}function u(e){for(var t=new Array(e.length),r=0;r<e.length;r++)"object"==typeof e[r]&&(t[r]=new RegExp("^(?:"+e[r].pattern+")$"));return function(r,n){for(var o="",u=r||{},s=n||{},c=s.pretty?a:encodeURIComponent,f=0;f<e.length;f++){var l=e[f];if("string"!=typeof l){var p,h=u[l.name];if(null==h){if(l.optional){l.partial&&(o+=l.prefix);continue}throw new TypeError('Expected "'+l.name+'" to be defined')}if(y(h)){if(!l.repeat)throw new TypeError('Expected "'+l.name+'" to not repeat, but received `'+JSON.stringify(h)+"`");if(0===h.length){if(l.optional)continue;throw new TypeError('Expected "'+l.name+'" to not be empty')}for(var d=0;d<h.length;d++){if(p=c(h[d]),!t[f].test(p))throw new TypeError('Expected all "'+l.name+'" to match "'+l.pattern+'", but received `'+JSON.stringify(p)+"`");o+=(0===d?l.prefix:l.delimiter)+p}}else{if(p=l.asterisk?i(h):c(h),!t[f].test(p))throw new TypeError('Expected "'+l.name+'" to match "'+l.pattern+'", but received "'+p+'"');o+=l.prefix+p}}else o+=l}return o}}function s(e){return e.replace(/([.+*?=^!:${}()[\]|\/\\])/g,"\\$1")}function c(e){return e.replace(/([=!:$\/()])/g,"\\$1")}function f(e,t){return e.keys=t,e}function l(e){return e.sensitive?"":"i"}function p(e,t){var r=e.source.match(/\((?!\?)/g);if(r)for(var n=0;n<r.length;n++)t.push({name:n,prefix:null,delimiter:null,optional:!1,repeat:!1,partial:!1,asterisk:!1,pattern:null});return f(e,t)}function h(e,t,r){for(var n=[],o=0;o<e.length;o++)n.push(v(e[o],t,r).source);var a=new RegExp("(?:"+n.join("|")+")",l(r));return f(a,t)}function d(e,t,r){return g(n(e,r),t,r)}function g(e,t,r){y(t)||(r=t||r,t=[]),r=r||{};for(var n=r.strict,o=r.end!==!1,a="",i=0;i<e.length;i++){var u=e[i];if("string"==typeof u)a+=s(u);else{var c=s(u.prefix),p="(?:"+u.pattern+")";t.push(u),u.repeat&&(p+="(?:"+c+p+")*"),p=u.optional?u.partial?c+"("+p+")?":"(?:"+c+"("+p+"))?":c+"("+p+")",a+=p}}var h=s(r.delimiter||"/"),d=a.slice(-h.length)===h;return n||(a=(d?a.slice(0,-h.length):a)+"(?:"+h+"(?=$))?"),a+=o?"$":n&&d?"":"(?="+h+"|$)",f(new RegExp("^"+a,l(r)),t)}function v(e,t,r){return y(t)||(r=t||r,t=[]),r=r||{},e instanceof RegExp?p(e,t):y(e)?h(e,t,r):d(e,t,r)}var y=e("isarray");t.exports=v,t.exports.parse=n,t.exports.compile=o,t.exports.tokensToFunction=u,t.exports.tokensToRegExp=g;var m=new RegExp(["(\\\\.)","([\\/.])?(?:(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?|(\\*))"].join("|"),"g")},{isarray:6}]},{},[1]);
